//
//  MarketDataModel.swift
//  Kriptot
//
//  Created by Samuel AYM on 14/08/23.
//

import Foundation


/*
 URL = https://api.coingecko.com/api/v3/global
 
 JSON Response :
 {
   "data": {
     "active_cryptocurrencies": 10035,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 811,
     "total_market_cap": {
       "btc": 41496673.22916632,
       "eth": 660082960.0175711,
       "ltc": 14834634286.630428,
       "bch": 5317368225.360628,
       "bnb": 5075085853.819519,
       "eos": 1696300686139.9097,
       "xrp": 1942719731131.6833,
       "xlm": 8892022088173.957,
       "link": 162595149524.34552,
       "dot": 244056449555.57297,
       "yfi": 193487353.65544146,
       "usd": 1219302747697.2847,
       "aed": 4478523378347.08,
       "ars": 350334576888550.5,
       "aud": 1875262020600.7224,
       "bdt": 134148949060696.6,
       "bhd": 459645434010.4359,
       "bmd": 1219302747697.2847,
       "brl": 5982489422732.768,
       "cad": 1639031867656.357,
       "chf": 1068955403089.7234,
       "clp": 1048905188706591.4,
       "cny": 8850918645534.61,
       "czk": 26744247433129.656,
       "dkk": 8296893082338.657,
       "eur": 1113430690114.732,
       "gbp": 959321796530.5239,
       "hkd": 9533283138742.184,
       "huf": 425704166757830.5,
       "idr": 18669866661356324,
       "ils": 4552181457335.492,
       "inr": 101331377808038.95,
       "jpy": 176761163971163.8,
       "krw": 1626597558455156.8,
       "kwd": 375073376127.4052,
       "lkr": 393447861288085.25,
       "mmk": 2573719873739259.5,
       "mxn": 20729134346079.496,
       "myr": 5624033923753.748,
       "ngn": 942829386854197,
       "nok": 12721772016998.045,
       "nzd": 2037014723110.245,
       "php": 69319792496269.72,
       "pkr": 353463419914994.6,
       "pln": 4939942897855.4375,
       "rub": 123823239846923.02,
       "sar": 4574175240298.443,
       "sek": 13177190128382.22,
       "sgd": 1650989569703.0242,
       "thb": 42874509561756.11,
       "try": 32984527939294.305,
       "twd": 38959525965945.25,
       "uah": 45263256548494.44,
       "vef": 122088784126.9294,
       "vnd": 29044850330453804,
       "zar": 23122519560470.215,
       "xdr": 916733990158.9509,
       "xag": 53654685830.77041,
       "xau": 636866211.1772475,
       "bits": 41496673229166.32,
       "sats": 4149667322916632
     },
     "total_volume": {
       "btc": 1013086.1906723978,
       "eth": 16115049.218498437,
       "ltc": 362167903.35128504,
       "bch": 129816486.49479637,
       "bnb": 123901484.01987174,
       "eos": 41412929438.12646,
       "xrp": 47428923303.97645,
       "xlm": 217086915255.44626,
       "link": 3969544732.9896107,
       "dot": 5958314234.585522,
       "yfi": 4723736.887907925,
       "usd": 29767657978.732056,
       "aed": 109337203109.04242,
       "ars": 8552953630783.821,
       "aud": 45782032850.47236,
       "bdt": 3275068510578.4565,
       "bhd": 11221633098.874533,
       "bmd": 29767657978.732056,
       "brl": 146054537590.12128,
       "cad": 40014787258.3569,
       "chf": 26097127144.006527,
       "clp": 25607627776204.31,
       "cny": 216083429267.61652,
       "czk": 652925298488.4087,
       "dkk": 202557630602.89804,
       "eur": 27182932236.438816,
       "gbp": 23420568176.84888,
       "hkd": 232742452540.54434,
       "huf": 10393002115430.596,
       "idr": 455800010566173.9,
       "ils": 111135467327.53809,
       "inr": 2473871073283.485,
       "jpy": 4315389170534.794,
       "krw": 39711220105570.48,
       "kwd": 9156918573.811714,
       "lkr": 9605507237153.434,
       "mmk": 62833954142418.234,
       "mxn": 506074297441.40826,
       "myr": 137303322426.90218,
       "ngn": 23017927888030.375,
       "nok": 310585175831.5081,
       "nzd": 49731010357.93098,
       "php": 1692350712800.9316,
       "pkr": 8629340179781.784,
       "pln": 120602148150.27655,
       "rub": 3022980027349.872,
       "sar": 111672416342.15816,
       "sek": 321703604460.1705,
       "sgd": 40306718680.15433,
       "thb": 1046724235675.2998,
       "try": 805273463166.683,
       "twd": 951145108266.1835,
       "uah": 1105042322330.3518,
       "vef": 2980635593.410448,
       "vnd": 709091464210383.8,
       "zar": 564505620267.4152,
       "xdr": 22380843418.967674,
       "xag": 1309907928.7593174,
       "xau": 15548243.115451373,
       "bits": 1013086190672.3978,
       "sats": 101308619067239.78
     },
     "market_cap_percentage": {
       "btc": 46.88783819500148,
       "eth": 18.201413970276768,
       "usdt": 6.833551881169461,
       "bnb": 3.0314778864824192,
       "xrp": 2.717184759494363,
       "usdc": 2.144596355159595,
       "steth": 1.2269015832251386,
       "doge": 0.8657215416297619,
       "ada": 0.8341303459489743,
       "sol": 0.8147962716433588
     },
     "market_cap_change_percentage_24h_usd": 0.16084560267210038,
     "updated_at": 1692009718
   }
 }
 */

struct GlobalData: Codable {
    
    let data: MarketDataModel?
}

// MARK: - DataClass
struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey{
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap : String {
        if let item = totalMarketCap.first(where: { (key,value) -> Bool in
            return key == "usd"
        }){
            return "\(item.value)"
        }
        return ""
    }
    
    var volume : String {
        if let item = totalVolume.first(where: { (key, value) -> Bool in
            return key == "usd"
        }){
            return "\(item.value)"
        }
        return ""
    }
    
    var btcDominance : String {
        if let item = marketCapPercentage.first(where: { (key, value) -> Bool in
            return key == "btc"
        }){
            return "\(item.value)"
        }
        return ""
    }
}
